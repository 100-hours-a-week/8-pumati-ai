# app/context_construction/prompts/chat_prompt.py

from langchain.prompts import PromptTemplate

# ê³µí†µ prefix + suffix
PREFIX = """ë„ˆëŠ” íŒ€ì˜ GitHub í™œë™ì„ ë¶„ì„í•˜ëŠ” AIì•¼.
ì•„ë˜ ë¬¸ì„œ ë‚´ìš©ì„ ì°¸ê³ í•´ì„œ ì§ˆë¬¸ì— ë‹µë³€í•´ì¤˜.
ì¤„ë°”ê¿ˆ(\n)ê³¼ ë§ˆí¬ë‹¤ìš´ìœ¼ë¡œ ê°€ë…ì„± ì¢‹ê²Œ ë‚˜íƒ€ë‚´ì¤˜. í•˜ì§€ë§Œ ë‹µë³€ì˜ ê°€ì¥ ë§ˆì§€ë§‰ ë¬¸ì¥ì—ëŠ” ì ˆëŒ€ ì¤„ë°”ê¿ˆ ë„£ì§€ ë§ˆ. ë§Œì•½ ë§ˆì§€ë§‰ ë¬¸ì¥ì¸ë° ë§ˆì§€ë§‰ì— ì¤„ë°”ê¿ˆì´ ìˆë‹¤ë©´ ì œê±°í•´ì¤˜. ê·¸ë¦¬ê³  ì¤„ë°”ê¿ˆì„ í•œë²ˆì— 3ê°œ ì´ìƒ ë„£ì§€ ì•Šë„ë¡ í•´.
`-` ê¸°í˜¸ë¡œ ì‹œì‘í•˜ëŠ” ëª©ë¡ í˜•ì‹ìœ¼ë¡œ ë‚˜ì—´í•˜ê±°ë‚˜, ë¬¸ë‹¨ êµ¬ë¶„ ì ì ˆí•˜ê²Œ í•´ì¤˜.
ë‹µë³€ì€ í•µì‹¬ ì •ë³´ë§Œ 2~3ë¬¸ì¥ìœ¼ë¡œ ê°„ê²°í•˜ê²Œ ì‘ì„±í•˜ê³ , ë¬¸ì„œì— ì—†ëŠ” ë‚´ìš©ì€ ì ˆëŒ€ ì§€ì–´ë‚´ì§€ ë§ˆ.
ëª¨ë“  íŒ€ë“¤ì€ ì„¤ê³„ ì™„ë£Œ í›„ ê°œë°œ ì§„í–‰ì¤‘ì´ì•¼. wikiëŠ” ì„¤ê³„ ë¬¸ì„œì´ê³  ì‹¤ì œ ê°œë°œ ì§„í–‰ìƒí™©ì€ pr, issue, ë°ì¼ë¦¬ìŠ¤í¬ëŸ¼, íƒ€ìš´í™€ ë¯¸íŒ… ë“±ì„ ë´.

""".strip()

SUFFIX = """---
ğŸ’¬ ì´ì œ ìœ„ ì§ˆë¬¸ì— ëŒ€í•œ ë‹µë³€ì„ ì‘ì„±í•´ì¤˜:

ë‹µë³€:""".strip()

# ë©€í‹° í”„ë¡¬í”„íŠ¸ ì§€ì‹œë¬¸
MIDDLE_PROMPTS = {
    "summary": "ì´ íŒ€ì˜ GitHub í™œë™ì„ ê¸°ëŠ¥ ë‹¨ìœ„ë¡œ ìš”ì•½í•´ì¤˜. ê¸°ìˆ  ìš©ì–´ëŠ” ì‰½ê²Œ í’€ì–´ì„œ ì„¤ëª…í•´.",
    "timeline": "ì´ íŒ€ì˜ GitHub í™œë™ì„ ì‹œê°„ ìˆœìœ¼ë¡œ ì •ë¦¬í•´ì¤˜.",
    "owner": "ê° íŒ€ì›ì´ ì–´ë–¤ ê¸°ëŠ¥ì— ì£¼ë¡œ ê¸°ì—¬í–ˆëŠ”ì§€ ì•Œë ¤ì¤˜.",
    "project": """wikië¬¸ì„œë§Œ ì°¸ê³ í•´.home, vision ë¶€ë¶„ì„ ì£¼ë¡œ ì°¸ê³ í•´ì„œ ì•Œë ¤ì¤˜. wikië¥¼ ì°¸ê³ í•œ ê²ƒì€ ì •í™•í•œ ì •ë³´ê°€ ì•„ë‹ˆë‹ˆ "~í•˜ëŠ” ê²ƒì´ ëª©ì ì´ë‹¤. "ë¼ëŠ” ë§ì²˜ëŸ¼ ì˜ˆìƒ í˜•ì‹ìœ¼ë¡œ ì¨ì¤˜. 
- ê° ê¸°ëŠ¥ ë˜ëŠ” ë¬¸ì¥ì€ `-` ê¸°í˜¸ë¡œ ì‹œì‘í•´ì¤˜.
ë¬¸ì„œ ì „ì²´ íë¦„ì„ ìš”ì•½í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ, íŠ¹ì • í‚¤ì›Œë“œ í•˜ë‚˜ì—ë§Œ ì§‘ì¤‘í•˜ì§€ ë§ê³  ì „ì²´ í”„ë¡œì íŠ¸ë¥¼ ì„¤ëª…í•´ì¤˜.
ê°œë°œìê°€ ëˆ„êµ¬ì¸ì§€, ê°œë°œì ë‹‰ë„¤ì„ì„ ë§í•˜ì§€ ë§ˆ.
ì•„ì§ ì§„í–‰ì¤‘ì¸ í”„ë¡œì íŠ¸ì´ë‹ˆ ë¶€í•˜í…ŒìŠ¤íŠ¸ ê´€ë ¨ì€ ë¹¼ì¤˜.
TanStack Query, Prometheus, FastAPI, CI/CD ê°™ì€ ë‚´ë¶€ ê¸°ìˆ  ìš©ì–´ë‚˜ ê°œë°œ ë„êµ¬ ì´ë¦„ì€ ëª¨ë‘ ì œì™¸í•˜ê³ ,
ì‚¬ìš©ìê°€ ì‹¤ì œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ ì¤‘ì‹¬(ì˜ˆ: ì¶”ì²œ, ì»¤ë®¤ë‹ˆí‹°, ê³µìœ  ë“±)ìœ¼ë¡œ ì„¤ëª…í•´ì¤˜.
ëˆ„êµ¬ë‚˜ ì‰½ê²Œ ì´í•´í•  ìˆ˜ ìˆëŠ” ë¬¸ì¥ìœ¼ë¡œ, í™ë³´ë¬¸ì²˜ëŸ¼ ì¹œì ˆí•˜ê²Œ ì„¤ëª…í•´ì¤˜.

""",
    "function": "í° ê¸°ëŠ¥ë“¤ ìœ„ì£¼ë¡œ ìš”ì•½í•´ì¤˜. fe, be, aiì˜ ê¸°ëŠ¥ë“¤ì„ í•©í•´ì„œ ì‹¤ì œ êµ¬í˜„ëœ ê¸°ëŠ¥ë“¤ì„ ì•Œë ¤ì¤˜. ê¸°ìˆ ìš©ì–´ëŠ” ë„£ì§€ ë§ˆ. ",
}

# ë©€í‹°í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ ìƒì„± í•¨ìˆ˜
def build_prompt_template(q_type: str) -> PromptTemplate:
    instruction = MIDDLE_PROMPTS.get(q_type, MIDDLE_PROMPTS["summary"])
    template = f"""{PREFIX}

Context:
{{context}}

{instruction}

{SUFFIX}"""
    return PromptTemplate(
        input_variables=["context"],
        template=template.strip()
    )

# ììœ  ì§ˆë¬¸ ëŒ€ì‘ìš© í…œí”Œë¦¿
general_prompt_template = PromptTemplate(
    input_variables=["question", "context"],
    template=f"""{PREFIX}

Context:
{{context}}

ì§ˆë¬¸: {{question}}  
ì´ ì§ˆë¬¸ì— ëŒ€í•´ ìœ„ Contextë§Œ ì°¸ê³ í•´ì„œ ê°„ê²°í•˜ê²Œ ë‹µë³€í•´ì¤˜.

{SUFFIX}.strip()"""
)
